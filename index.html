<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Cached Image by floydpink</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Cached Image</h1>
        <p>A WPF control that wraps the Image control to enable file-system based caching.</p>

        <p class="view"><a href="https://github.com/floydpink/CachedImage">View the Project on GitHub <small>floydpink/CachedImage</small></a></p>


        <ul>
          <li><a href="https://github.com/floydpink/CachedImage/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/floydpink/CachedImage/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/floydpink/CachedImage">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <p><img src="http://floydpink.github.io/CachedImage/images/logo.png" alt="logo" width="300px"></p>

<h1>
<a name="cachedimage--" class="anchor" href="#cachedimage--"><span class="octicon octicon-link"></span></a>CachedImage <a href="http://badge.fury.io/nu/CachedImage"><img src="https://badge.fury.io/nu/CachedImage.png" alt="NuGet version"></a> <a href="https://ci.appveyor.com/project/floydpink/cachedimage"><img src="https://ci.appveyor.com/api/projects/status/6tb8p301yio5fmh4" alt="Build status"></a>
</h1>

<h5>
<a name="a-wpf-control-that-wraps-the-image-control-to-enable-file-system-based-caching" class="anchor" href="#a-wpf-control-that-wraps-the-image-control-to-enable-file-system-based-caching"><span class="octicon octicon-link"></span></a>A WPF control that wraps the Image control to enable file-system based caching.</h5>

<h3>
<a name="background" class="anchor" href="#background"><span class="octicon octicon-link"></span></a>Background</h3>

<p>If we use the native WPF <code>Image</code> control for displaying images over the HTTP protocol (by setting the <code>Source</code> to an http url), the image will be downloaded from the server every time the control is loaded. </p>

<p>The <code>Image</code> control present in this <code>CachedImage</code> library, wraps the native <code>Image</code> control to add a local file-system based caching capability. This control creates a local copy of the image on the first time an image is downloaded; to a configurable cache folder (defaults to <code>&lt;current-user/appdata/roaming&gt;\AppName\Cache</code>). All the subsequent loads of the control (or the page, window or app that contains the control), will display the image from the local file-system and will not download it from the server.</p>

<h3>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h3>

<ol>
<li>Install the NuGet package named <code>CachedImage</code> on the WPF project </li>
<li>
<p>Add a namespace reference to the <code>CachedImage</code> assembly on the Window/Usercontrol <code>xmlns:cachedImage="clr-namespace:CachedImage;assembly=CachedImage"</code> as in the example <code>Window</code> below:</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;Window</span> <span class="na">x:Class=</span><span class="s">"MyWindow1"</span>
        <span class="na">xmlns=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
        <span class="na">xmlns:x=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
        <span class="na">xmlns:d=</span><span class="s">"http://schemas.microsoft.com/expression/blend/2008"</span>
        <span class="na">xmlns:mc=</span><span class="s">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
        <span class="na">xmlns:cachedImage=</span><span class="s">"clr-namespace:CachedImage;assembly=CachedImage"</span><span class="nt">&gt;</span>

<span class="nt">&lt;/Window&gt;</span>
</pre></div>
</li>
<li>
<p>Use the control and set or bind the <code>ImageUrl</code> attribute:</p>

<div class="highlight highlight-xml"><pre>
    <span class="nt">&lt;cachedImage:Image</span> <span class="na">ImageUrl=</span><span class="s">"{Binding LargeImageUrl, IsAsync=True}"</span><span class="nt">&gt;</span>  <span class="nt">&lt;/cachedImage:Image&gt;</span>
</pre></div>
</li>
<li>
<p>As it is only a wrapper, all the XAML elements that could be used with the <code>Image</code> control are valid here as well:</p>

<div class="highlight highlight-xml"><pre>
  <span class="nt">&lt;cachedImage:Image</span> <span class="na">ImageUrl=</span><span class="s">"{Binding LargeImageUrl, IsAsync=True}"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Image.ToolTip&gt;</span>This image gets cached to the file-system the first time it is downloaded<span class="nt">&lt;/Image.ToolTip&gt;</span>
  <span class="nt">&lt;/cachedImage:Image&gt;</span>
</pre></div>
</li>
<li>
<p>To change the cache folder location set the static string property named <code>AppCacheDirectory</code> of the <code>FileCache</code> class like this:</p>

<div class="highlight highlight-csharp"><pre>
  <span class="n">CachedImage</span><span class="p">.</span><span class="n">FileCache</span><span class="p">.</span><span class="n">AppCacheDirectory</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="s">"{0}\\MyCustomCacheFolder\\"</span><span class="p">,</span>
                                <span class="n">Environment</span><span class="p">.</span><span class="n">GetFolderPath</span><span class="p">(</span><span class="n">Environment</span><span class="p">.</span><span class="n">SpecialFolder</span><span class="p">.</span><span class="n">ApplicationData</span><span class="p">));</span>
</pre></div>
</li>
<li>Please note that the control does not consider <code>Cache-Control</code> or <code>Expires</code> headers. Unless the cache folder (or specific files in it) gets deleted, the control will not fetch the file again from the server. The application could let the end-user empty the cache folder as done in the <a href="https://github.com/flickr-downloadr/flickr-downloadr">flickr downloadr</a> application that uses this control.</li>
</ol><h3>
<a name="thanks" class="anchor" href="#thanks"><span class="octicon octicon-link"></span></a>Thanks</h3>

<p>All of the code in this library is from the answers on a Stack Overflow question:</p>

<p><a href="http://stackoverflow.com/questions/1878060/how-do-i-cache-images-on-the-client-for-a-wpf-application">How do I cache images on the client for a WPF application?</a>. </p>

<p>Thanks to:</p>

<ol>
<li><p><a href="http://stackoverflow.com/users/459159/simon-hartcher">Simon Hartcher</a>, who answered his own question <a href="http://stackoverflow.com/questions/1878060/how-do-i-cache-images-on-the-client-for-a-wpf-application/1893173#1893173">with the solution</a></p></li>
<li><p><a href="http://stackoverflow.com/users/641271/jeroen-van-langen">Jeroen van Langen</a> for <a href="http://stackoverflow.com/questions/1878060/how-do-i-cache-images-on-the-client-for-a-wpf-application/5175424#5175424">the wonderful refacoring</a> of Simon's solution</p></li>
<li><p><a href="http://stackoverflow.com/users/367287/ivan-leonenko">Ivan Leonenko</a> for <a href="http://stackoverflow.com/questions/1878060/how-do-i-cache-images-on-the-client-for-a-wpf-application/12638859#12638859">the tweaks to make the control bindable</a>.</p></li>
</ol><h3>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h3>

<p><a href="https://raw.github.com/floydpink/CachedImage/master/LICENSE">MIT License</a></p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/floydpink">floydpink</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-36383654-5");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>